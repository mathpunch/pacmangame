<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Pac-Man</title>
  <style>
    body {
      margin: 0;
      background: black;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      overflow: hidden;
      touch-action: none; /* prevent page scrolling on swipe */
    }
    canvas {
      background: black;
      border: 2px solid white;
      image-rendering: pixelated;
    }
  </style>
</head>
<body>
  <canvas id="game" width="448" height="496"></canvas>

  <script>
    const canvas = document.getElementById("game");
    const ctx = canvas.getContext("2d");

    const map = [
      [1,1,1,1,1,1,1,1,1,1,1,1,1,1],
      [1,0,0,0,0,0,1,0,0,0,0,0,0,1],
      [1,0,1,1,1,0,1,0,1,1,1,1,0,1],
      [1,0,0,0,1,0,0,0,0,0,0,1,0,1],
      [1,1,1,0,1,1,1,1,1,1,0,1,0,1],
      [1,0,0,0,0,0,0,0,1,0,0,1,0,1],
      [1,0,1,1,1,1,1,0,1,0,1,1,0,1],
      [1,0,0,0,0,0,1,0,0,0,0,0,0,1],
      [1,1,1,1,1,0,1,1,1,1,1,1,1,1]
    ];

    const tileSize = 32;
    let score = 0;

    const pacman = {
      x: 1,
      y: 1,
      dir: 0,
      nextDir: 0
    };

    // --- Keyboard Controls ---
    document.addEventListener("keydown", (e) => {
      if (e.key === "ArrowRight") pacman.nextDir = 0;
      if (e.key === "ArrowDown") pacman.nextDir = 1;
      if (e.key === "ArrowLeft") pacman.nextDir = 2;
      if (e.key === "ArrowUp") pacman.nextDir = 3;
    });

    function canMove(x, y) {
      return map[y] && map[y][x] === 0;
    }

    function movePacman() {
      let newX = pacman.x;
      let newY = pacman.y;
      if (pacman.nextDir === 0 && canMove(pacman.x + 1, pacman.y)) pacman.dir = 0;
      if (pacman.nextDir === 1 && canMove(pacman.x, pacman.y + 1)) pacman.dir = 1;
      if (pacman.nextDir === 2 && canMove(pacman.x - 1, pacman.y)) pacman.dir = 2;
      if (pacman.nextDir === 3 && canMove(pacman.x, pacman.y - 1)) pacman.dir = 3;

      if (pacman.dir === 0) newX++;
      if (pacman.dir === 1) newY++;
      if (pacman.dir === 2) newX--;
      if (pacman.dir === 3) newY--;

      if (canMove(newX, newY)) {
        pacman.x = newX;
        pacman.y = newY;
        if (map[pacman.y][pacman.x] === 0) {
          map[pacman.y][pacman.x] = -1;
          score++;
        }
      }
    }

    function draw() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);

      // Draw map
      for (let y = 0; y < map.length; y++) {
        for (let x = 0; x < map[y].length; x++) {
          if (map[y][x] === 1) {
            ctx.fillStyle = "blue";
            ctx.fillRect(x * tileSize, y * tileSize, tileSize, tileSize);
          } else if (map[y][x] === 0) {
            ctx.fillStyle = "white";
            ctx.beginPath();
            ctx.arc(
              x * tileSize + tileSize / 2,
              y * tileSize + tileSize / 2,
              3,
              0,
              2 * Math.PI
            );
            ctx.fill();
          }
        }
      }

      // Draw Pac-Man
      ctx.beginPath();
      ctx.fillStyle = "yellow";
      ctx.arc(
        pacman.x * tileSize + tileSize / 2,
        pacman.y * tileSize + tileSize / 2,
        tileSize / 2 - 2,
        0,
        2 * Math.PI
      );
      ctx.fill();

      // Draw Score
      ctx.fillStyle = "white";
      ctx.font = "20px Arial";
      ctx.fillText("Score: " + score, 10, canvas.height - 10);
    }

    function gameLoop() {
      movePacman();
      draw();
      requestAnimationFrame(gameLoop);
    }
    gameLoop();

    // --- Mobile Swipe Controls ---
    let touchStartX = 0;
    let touchStartY = 0;
    let touchEndX = 0;
    let touchEndY = 0;

    const minSwipeDistance = 30; // pixels required to count as swipe

    document.addEventListener("touchstart", (e) => {
      const touch = e.changedTouches[0];
      touchStartX = touch.screenX;
      touchStartY = touch.screenY;
    });

    document.addEventListener("touchend", (e) => {
      const touch = e.changedTouches[0];
      touchEndX = touch.screenX;
      touchEndY = touch.screenY;
      handleSwipeGesture();
    });

    function handleSwipeGesture() {
      const diffX = touchEndX - touchStartX;
      const diffY = touchEndY - touchStartY;

      if (Math.abs(diffX) < minSwipeDistance && Math.abs(diffY) < minSwipeDistance) return;

      if (Math.abs(diffX) > Math.abs(diffY)) {
        if (diffX > 0) pacman.nextDir = 0; // right
        else pacman.nextDir = 2; // left
      } else {
        if (diffY > 0) pacman.nextDir = 1; // down
        else pacman.nextDir = 3; // up
      }
    }
  </script>
</body>
</html>
